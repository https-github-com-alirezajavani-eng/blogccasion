<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta property="twitter:account_id" content="1510101733"><meta name="description" content="The personal blog of Thomas Steiner"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="monetization" content="$pay.stronghold.co/1a1c51358527bef4dc7bcc3e92b155ec07a"><meta name="theme-color"><link rel="icon" href="/images/thomas_steiner.jpg"><link rel="canonical" href="/blogccasion/2019/09/16/not-all-is-nothing-finding-out-if-the-browser-supports-a-given-media-query/"><link rel="alternate" href="/blogccasion/feed/feed.xml" type="application/atom+xml" title="Blogccasion"><link rel="author" href="https://tomayac.com/humans.txt" type="text/plain"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet"><script>if (window.matchMedia('(prefers-color-scheme: dark)').media === 'not all') {
        document.documentElement.style.display = 'none';
        document.head.insertAdjacentHTML(
            'beforeend',
            '<link rel="stylesheet" href="/light.css" onload="document.documentElement.style.display = \'\'">'
        );
      }</script><link rel="stylesheet" href="/css/light.css" media="(prefers-color-scheme:light),(prefers-color-scheme:no-preference)"><link rel="stylesheet" href="/css/dark.css" media="(prefers-color-scheme:dark)"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/prism-theme.css"><link rel="webmention" href="https://webmention.io/blog.tomayac.com/webmention"><link rel="pingback" href="https://webmention.io/blog.tomayac.com/xmlrpc"><title>Not All Is Nothing—Finding Out If the Browser Supports a Given Media Query</title><script type="module" src="/js/script.mjs"></script></head><body><div class="container"><header><a href="/"><h1>blogccasion</h1></a><div class="header-footer-text"><span lang="fr"><strong>l'occasion</strong> <em>f</em> — </span><span lang="de">Gelegenheit</span> <em>f</em>, die ~ , der ~; <em>bei Gelegenheit</em> — <span lang="fr"><strong>à l'occasion</strong></span></div></header><main class="tmpl-post"><article><header><a href="/blogccasion/2019/09/16/not-all-is-nothing-finding-out-if-the-browser-supports-a-given-media-query/"><h3>Not All Is Nothing—Finding Out If the Browser Supports a Given Media Query</h3></a><div class="metadata post-date"><img class="author" src="/images/thomas_steiner.jpg" alt="Thomas Steiner headshot"><p>By <a href="/about/">Thomas Steiner</a>. Written on <time datetime="2019-09-16T00:19:54.000Z">Mon Sep 16 2019</time>. <a href="/tags/Technical" class="tag"><b>Technical</b></a></p></div></header><p>On the Google Chrome team, we're working on solving the interesting problem that some platforms like Windows 10 show a native <em>← Back</em> button in the app window's title bar when the user has navigated into a standalone or fullscreen Progressive Web App (PWA). This can lead to PWAs inadvertently showing two means of in-app navigation: one from the operating system and one from the app itself. The screenshot below from Twitter's PWA illustrates this issue well. The two back buttons are highlighted in red, the Windows-generated button is in the title bar.</p><img src="/images/twitter-double-back-button.png" width="1681" height="749" alt="Two back buttons in Twitter's PWA, one from Windows 10, one from the app."><p>In order for PWAs to be able to detect the presence or absence of system-level navigation controls, we've proposed a new, aptly named CSS media query called <code>navigation-controls</code>. The <a href="https://github.com/fallaciousreasoning/backbutton-mediaquery/blob/master/explainer.md#css">Explainer</a> goes into great detail on how this media query works, but the most basic way to use it can be seen in the code sample below.</p><pre class="language-css"><code class="language-css"><span class="token comment">/**<br><span class="highlight-line"> * Hide the app's own back button if the browser or the OS</span><br><span class="highlight-line"> * provides any navigation controls.</span><br> */</span><br><span class="highlight-line"><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span>navigation-controls<span class="token punctuation">)</span></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token selector">#back-button</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>This leads to the interesting question how developers can find out via JavaScript if a media query is supported and understood at all by a browser. Note that the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@supports"><code>@supports</code> CSS at-rule</a> can't be used to detect media query support. Before we dive into this question, let's get some things defined first.</p><h4 id="media-types">Media types <a class="direct-link" href="#media-types">#</a></h4><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries#Media_types">Media types</a> describe the general category of a device. Some examples are <code>print</code>, <code>screen</code>, <code>speech</code>, or simply the default media type <code>all</code>.</p><h4 id="media-features">Media features <a class="direct-link" href="#media-features">#</a></h4><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries#Media_features">Media features</a> describe specific characteristics of the user agent, output device, or environment. Media feature expressions test for their presence or value. Examples are <code>prefers-color-scheme</code>, <code>hover</code>, and many more. Media feature expressions must always be surrounded by parentheses.</p><p>Let's take a media feature expression like <code>(max-width: 600px)</code>. From a JavaScript context, you can test if it matches as shown below.</p><pre class="language-js"><code class="language-js"><span class="highlight-line">window<span class="token punctuation">.</span><span class="token function">matchMedia</span><span class="token punctuation">(</span><span class="token string">'(max-width: 600px)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>matches<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token comment">// Returns either `true` or `false`.</span></span></code></pre><p>Some media features are evaluated in the <a href="https://drafts.csswg.org/mediaqueries-5/#boolean-context">boolean context</a>. This means that if the feature would be true for any value other than the number <code>0</code>, a <code>&lt;dimension&gt;</code> with the value <code>0</code>, the keyword <code>none</code>, or a value explicitly defined by that media feature to evaluate as false in a boolean context, the media feature evaluates to true. This is oftentimes a convenient shorthand for features like <code>hover</code> that accepts the two values <code>none</code> and <code>hover</code>. Usually you don't mind for the <code>none</code> value, but instead want to make sure you only use hover events if the user agent has some kind of hoverable device like a mouse. In this case, you can simply test for <code>@media (hover) { … }</code>.</p><h4 id="testing-if-a-browser-understands-a-media-query">Testing if a browser understands a media query <a class="direct-link" href="#testing-if-a-browser-understands-a-media-query">#</a></h4><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia"><code>window.matchMedia()</code></a> method returns a <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList"><code>MediaQueryList</code></a> whose <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList/media"><code>media</code></a> read-only property is a <code>DOMString</code> representing a serialized media query. What this means in practice is that we can use this to normalize media query expression strings.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token comment">// Note the superfluous spaces and the '+' before the width</span></span><br><span class="highlight-line">window<span class="token punctuation">.</span><span class="token function">matchMedia</span><span class="token punctuation">(</span><span class="token string">'(  max-width:       +600px)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>media<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token comment">// Returns `"(max-width: 600px)"`.</span></span></code></pre><p>The newly proposed media feature <code>navigation-controls</code>—apart from <code>back</code>—has <code>none</code> as one of its allowed keywords, and is evaluated in a boolean context. Bringing things together, we can thus check if the browser understands it by looking at the <code>media</code> property.</p><pre class="language-js"><code class="language-js"><span class="highlight-line">window<span class="token punctuation">.</span><span class="token function">matchMedia</span><span class="token punctuation">(</span><span class="token string">'(navigation-controls)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>media<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token comment">// Returns `"not all"` when the browser doesn't understand</span></span><br><span class="highlight-line"><span class="token comment">// the media query, or `"(navigation-controls)"` else.</span></span></code></pre><p>The interesting value here is <code>&quot;not all&quot;</code>, meaning the browser doesn't understand the media feature. If the browser doesn't have the slightest clue what <code>navigation-controls</code> is about, it tells you the serialization of this (unknown) media feature is something that will never match: the media <em>type</em> <code>@media not all</code>. Because <code>not all</code> is <a href="https://en.wikipedia.org/wiki/Nothing">nothing</a>.</p></article><section><h3>Webmentions</h3></section><p>You can <a href="https://github.com/tomayac/blogccasion/tree/master/./posts/2019/2019-09-16_not-all-is-nothing-finding-out-if-the-browser-supports-a-given-media-query.md" rel="nofollow">edit this page on GitHub</a>.</p></main><nav><h2>Pages</h2><ul><li><a class="nav-item" href="/blogccasion/">Home</a></li><li><a class="nav-item" href="/blogccasion/posts/">Archive</a></li><li><a class="nav-item" href="/blogccasion/about/">About</a></li></ul><h2>Tags</h2><ul><li><a href="/blogccasion/tags/Technical/" class="tag">Technical</a></li><li><a href="/blogccasion/tags/France/" class="tag">France</a></li><li><a href="/blogccasion/tags/Work/" class="tag">Work</a></li><li><a href="/blogccasion/tags/Private/" class="tag">Private</a></li><li><a href="/blogccasion/tags/Political/" class="tag">Political</a></li></ul></nav><svg xmlns="http://www.w3.org/2000/svg"><symbol id="icon-rss" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></symbol><symbol id="icon-twitter" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></symbol><symbol id="icon-pgp" aria-label="Lock" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#29303d"/><g fill="#29303d"><path stroke="#e0e4eb" stroke-width="32" d="M346 214v-37c0-123-180-123-180 0v37"/><rect fill="#ff0" height="210" rx="5%" width="280" x="115" y="210"/><circle cx="256" cy="296" r="28"/><path d="M262 296h-12l-16 69h44"/></g></symbol><symbol id="icon-github" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></symbol></svg><aside><h2>Related</h2><ul><li><a class="aside-item" href="/blogccasion/feed/feed.xml" rel="me"><svg class="icon"><use xlink:href="#icon-rss"></use></svg> Blog Feed</a></li><li><a class="aside-item" href="https://twitter.com/tomayac" rel="me"><svg class="icon"><use xlink:href="#icon-twitter"></use></svg> Twitter</a></li><li><a class="aside-item" href="https://tomayac.com/tweets" rel="me"><svg class="icon"><use xlink:href="#icon-twitter"></use></svg> Tweet Archive</a></li><li><a class="aside-item" href="https://github.com/tomayac" rel="me"><svg class="icon"><use xlink:href="#icon-github"></use></svg> GitHub</a></li><li><a class="aside-item" href="/pgp_public_key.asc"><svg class="icon"><use xlink:href="#icon-pgp"></use></svg> Public Key</a></li></ul></aside><footer id="footer"><ul class="header-footer-text"><li>© 2005–2019 <a class="footer-link" href="/about">Thomas Steiner</a>.</li><li>Distributed under <a class="footer-link" rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.</li><li>Contact and required <a class="footer-link" href="/about/">legal info</a>.</li></ul><dark-mode-toggle permanent dark="Light Theme" light="Dark Theme"></dark-mode-toggle><a class="validator" href="https://validator.w3.org/nu/?doc=https://blog.tomayac.com//blogccasion/2019/09/16/not-all-is-nothing-finding-out-if-the-browser-supports-a-given-media-query/"><img src="/static/validhtml5.svg" width="88" height="31" alt="Valid HTML5 badge"></a></footer></div></body></html>