<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta property="twitter:account_id" content="1510101733"><meta name="description" content="The other day, one of my former Google Mobile Solutions Consultant colleagues sent an email to an internal mailing list that (paraphrased) went like this: I suspect at least some of you are the same‚Ä¶"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><link rel="icon" href="/images/thomas_steiner.jpg"><link rel="canonical" href="/blogccasion/2019/03/22/two-http-headers-related-to-service-workers-you-never-may-have-heard-of/"><link rel="alternate" href="/blogccasion/feed/feed.xml" type="application/atom+xml" title="Blogccasion"><link rel="author" href="https://tomayac.com/humans.txt" type="text/plain"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/prism-theme.css"><title>Two HTTP headers related to Service Workers you never may have heard¬†of</title><script type="module" src="/js/script.mjs"></script></head><body><div class="container"><header><a href="/"><h1>blogccasion</h1></a><div class="header-footer-text"><span lang="fr"><strong>l'occasion</strong> <em>f</em> ‚Äî </span><span lang="de">Gelegenheit</span> <em>f</em>, die ~ , der ~; <em>bei Gelegenheit</em> ‚Äî <span lang="fr"><strong>√† l'occasion</strong></span></div></header><nav><h2>Pages</h2><ul><li><a class="nav-item" href="/blogccasion/">Home</a></li><li><a class="nav-item" href="/blogccasion/posts/">Archive</a></li><li><a class="nav-item" href="/blogccasion/about/">About</a></li></ul><h2>Tags</h2><ul><li><a href="/blogccasion/tags/Private/" class="tag">Private</a></li><li><a href="/blogccasion/tags/Technical/" class="tag">Technical</a></li><li><a href="/blogccasion/tags/France/" class="tag">France</a></li><li><a href="/blogccasion/tags/Work/" class="tag">Work</a></li><li><a href="/blogccasion/tags/Political/" class="tag">Political</a></li></ul></nav><svg xmlns="http://www.w3.org/2000/svg"><symbol id="icon-rss" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></symbol><symbol id="icon-twitter" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></symbol><symbol id="icon-pgp" aria-label="Lock" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#29303d"/><g fill="#29303d"><path stroke="#e0e4eb" stroke-width="32" d="M346 214v-37c0-123-180-123-180 0v37"/><rect fill="#ff0" height="210" rx="5%" width="280" x="115" y="210"/><circle cx="256" cy="296" r="28"/><path d="M262 296h-12l-16 69h44"/></g></symbol><symbol id="icon-github" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></symbol></svg><aside><h2>Related</h2><ul><li><a class="aside-item" href="/blogccasion/feed/feed.xml" rel="me"><svg class="icon"><use xlink:href="#icon-rss"></use></svg> Blog Feed</a></li><li><a class="aside-item" href="https://twitter.com/tomayac" rel="me"><svg class="icon"><use xlink:href="#icon-twitter"></use></svg> Twitter</a></li><li><a class="aside-item" href="https://tomayac.com/tweets" rel="me"><svg class="icon"><use xlink:href="#icon-twitter"></use></svg> Tweet Archive</a></li><li><a class="aside-item" href="https://github.com/tomayac" rel="me"><svg class="icon"><use xlink:href="#icon-github"></use></svg> GitHub</a></li><li><a class="aside-item" href="/pgp_public_key.asc"><svg class="icon"><use xlink:href="#icon-pgp"></use></svg> Public Key</a></li></ul></aside><main class="tmpl-post"><h2>A Look Inside the Think Tank...</h2><article><header><a href="/blogccasion/2019/03/22/two-http-headers-related-to-service-workers-you-never-may-have-heard-of/"><h3>Two HTTP headers related to Service Workers you never may have heard¬†of</h3></a><div class="metadata"><a href="/about/"><img class="author" src="/images/thomas_steiner.jpg" alt="Thomas Steiner headshot"></a>By <a href="/about/">Thomas Steiner</a>. Written on <time datetime="2019-03-22T09:51:16.943Z">Fri Mar 22 2019</time>. <a href="/tags/Technical" class="tag"><b>Technical</b></a></div></header><h2 id="the-second-one-will-make-you-talk-to-your-webmaster%E2%80%A6">The second one will make you talk to your webmaster‚Ä¶ <a class="direct-link" href="#the-second-one-will-make-you-talk-to-your-webmaster%E2%80%A6">#</a></h2><p>The other day, one of my former Google Mobile Solutions Consultant colleagues sent an email to an internal mailing list that (paraphrased) went like this:</p><blockquote><p>‚ÄúI was shocked that during now more than two years of supporting Service Worker implementations, I only found out about the <code>service-worker-allowed</code> header today.‚Äù üò≥</p></blockquote><p>I suspect at least some of you are the same, so let me explain not just this, but also a second interesting HTTP header related to Service Workers that are both probably <em>not</em> the ones you read about when you follow any of the many Service Worker tutorials out there.</p><h4 id="header-%E2%84%96-1%3A-%60service-worker-allowed%60"><strong>Header</strong> ‚Ññ 1: `<strong>service-worker-allowed`</strong> <a class="direct-link" href="#header-%E2%84%96-1%3A-%60service-worker-allowed%60">#</a></h4><p>This is one of the a little more obscure Service Worker features, but it‚Äôs very useful. You can see it in action on Google Docs, where the URL you‚Äôre on with <a href="https://support.google.com/accounts/answer/1721977?co=GENIE.Platform%3DDesktop&amp;hl=en">multi-account login</a> is something like <code>https://docs.google.com/document/u/0/</code> (the final number determines the active account), but where the actual Service Worker JavaScript file comes from <code>https://docs.google.com/document/offline/serviceworker.js?ouid=ude32cf1e51077bff&amp;zx=hyah3kexco7d</code> (your query parameters may differ).</p><p>Now why does this matter? Let‚Äôs briefly recall the <a href="https://developers.google.com/web/ilt/pwa/introduction-to-service-worker#registration_and_scope">concept of a Service Worker‚Äôs</a> <code>[scope](https://developers.google.com/web/ilt/pwa/introduction-to-service-worker#registration_and_scope)</code>: The <code>scope</code> of the Service Worker determines which files the Service Worker controls, in other words, from which path the Service Worker will intercept requests. The default <code>scope</code> is the location of the Service Worker file, and extends to all directories below. So if <code>serviceworker.js</code> is located in the root directory, the Service Worker will control requests from all files at this domain.</p><p>Now you may notice that in the case of Google Docs, the default <code>scope</code> would be <code>https://docs.google.com/document/offline/</code>, which is not enough, as the user is working in <code>https://docs.google.com/document/u/0/</code>. This is where finally the <code>service-worker-allowed</code> header comes in. It allows Google Docs to ask for a wider <code>scope</code> of <code>https://docs.google.com/document/</code> instead üéâ. This header is <a href="https://wpt.fyi/results/service-workers/service-worker/Service-Worker-Allowed-header.https.html?label=master&amp;product=chrome%5Bexperimental%5D&amp;product=edge&amp;product=firefox%5Bexperimental%5D&amp;product=safari%5Bexperimental%5D&amp;aligned&amp;q=service-worker-allowed">supported by all browsers</a> and if you‚Äôre interested in all the details, this is the <a href="https://w3c.github.io/ServiceWorker/#service-worker-allowed">deep link to the header‚Äôs section in the spec</a>. You can see it in action in the screenshot below.</p><p><img src="/images/asset-1_copy.png" alt="HTTP header `service-worker-allowed` in action on Google¬†Docs"></p><h4 id="header-%E2%84%96-2%3A-%60service-worker%60">Header ‚Ññ 2: `<strong>service-worker`</strong> <a class="direct-link" href="#header-%E2%84%96-2%3A-%60service-worker%60">#</a></h4><p>As we‚Äôre at it, another header you might not have heard of is <code>service-worker</code>. It indicates when a request is for a Service Worker‚Äôs script resource and helps administrators and webmasters log such requests and detect threats (so talk to them, they‚Äôll probably appreciate it; <a href="https://twitter.com/jaffathecake">Jake Archibald</a>‚Äôs <a href="https://jakearchibald.com/2014/launching-sw-without-breaking-the-web/#pros">article</a> has all the details). This header as well is <a href="https://wpt.fyi/results/service-workers/service-worker/service-worker-header.https.html?label=master&amp;product=chrome%5Bexperimental%5D&amp;product=edge&amp;product=firefox%5Bexperimental%5D&amp;product=safari%5Bexperimental%5D&amp;aligned&amp;q=service-worker">supported by all browsers</a>, and here is the <a href="https://w3c.github.io/ServiceWorker/#service-worker-script-request">deep link to its section in the spec</a>. You can see it in action when you go to Facebook. Facebook‚Äôs Service Worker comes from <code>[https://www.facebook.com/sw?s=push](https://www.facebook.com/sw?s=push)</code>, but if you try to open this URL, you‚Äôll not see the JavaScript code, but a Facebook error page. You actually <em>need</em> to send the header in order for Facebook to return the code.</p><p><img src="/images/asset-2_copy.png" alt="HTTP header `service-worker` in action on¬†Facebook"></p><p>This initially caught me when I developed the <a href="https://github.com/google/service-worker-detector#--installation">üë∑‚Äç‚ôÄÔ∏è üë∑ Service Worker Detector browser extension</a>, but after reading the spec, I was then <a href="https://github.com/google/service-worker-detector/blob/f257aa9a77951f8ec972bf271093c75e86f73e55/contentscript.js#L71-L75">sending the correct header</a> in the extension‚Äôs content script, so that it now works as expected.</p><p><img src="/images/asset-3__copy.png" alt="üë∑‚Äç‚ôÄÔ∏è üë∑ Service Worker Detector browser extension running on¬†Facebook"></p><p>If you encounter this header being required by the server, for quick debugging sessions in the browser or from the terminal, a cool Chrome DevTools tip is to right-click the Service Worker request and then ‚ÄúCopy as cURL‚Äù or ‚ÄúCopy as fetch‚Äù. üëå</p><p><img src="/images/asset-4.png" alt="Fetch a resource exactly as the browser did with ‚ÄúCopy as cURL‚Äù or ‚ÄúCopy as¬†fetch‚Äù"></p><p>Did <em>you</em> know about these headers? Let me know in the comments or ping me, <a href="https://twitter.com/tomayac">@tomayac</a>, on Twitter. Oh, by the way, while I still have your attention, the Mobile Solutions Consultant team (my former team) are <a href="https://careers.google.com/jobs/results/?company=Google&amp;company=YouTube&amp;employment_type=FULL_TIME&amp;hl=en_US&amp;jlo=en_US&amp;q=%22Mobile%20Solutions%20Consultant%22&amp;sort_by=relevance">hiring</a>, and so is my current team, the Chrome Developer Relations team, where we‚Äôre looking for <a href="https://careers.google.com/jobs/results/?company=Google&amp;company=YouTube&amp;employment_type=FULL_TIME&amp;hl=en_US&amp;jlo=en_US&amp;q=%22developer%20advocate,%20web%22&amp;sort_by=relevance">Developer Advocates</a> and <a href="https://careers.google.com/jobs/results/?company=Google&amp;company=YouTube&amp;employment_type=FULL_TIME&amp;hl=en_US&amp;jlo=en_US&amp;q=%22Developer%20Programs%20Engineer,%20Web%22&amp;sort_by=relevance">Developer Programs Engineers</a>‚Ä¶</p></article><p>You can <a href="https://github.com/tomayac/blogccasion/tree/master/./posts/2019-03-22_two-http-headers-related-to-service-workers-you-never-may-have-heard-of.md" rel="nofollow">edit this page on GitHub</a>.</p></main><footer id="footer"><a class="validator" href="https://html5.validator.nu/?doc=https://blog.tomayac.com//blogccasion/2019/03/22/two-http-headers-related-to-service-workers-you-never-may-have-heard-of/"><img src="/static/validhtml5.svg" width="88" height="31" alt="Valid HTML5 badge"></a><dark-mode-toggle></dark-mode-toggle><ul class="header-footer-text"><li>¬© 2005‚Äì2019 <a class="footer-link" href="/about">Thomas Steiner</a>.</li><li>Distributed under <a class="footer-link" rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.</li><li>Contact and required <a class="footer-link" href="/about/">legal info</a>.</li></ul></footer></div></body></html>