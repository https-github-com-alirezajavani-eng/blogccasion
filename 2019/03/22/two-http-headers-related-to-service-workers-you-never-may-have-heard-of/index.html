<!doctype html><html><head><meta charset="utf-8"><title>Two HTTP headers related to Service Workers you never may have heard¬†of</title><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta property="twitter:account_id" content="1510101733"><meta name="Description" content="The other day, one of my former Google Mobile Solutions Consultant colleagues sent an email to an internal mailing list that (paraphrased) went like this: I suspect at least some of you are the same‚Ä¶"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="/blogccasion/2019/03/22/two-http-headers-related-to-service-workers-you-never-may-have-heard-of/"><link rel="alternate" href="/blogccasion/feed/feed.xml" type="application/atom+xml" title="Blogccasion"><link type="text/plain" rel="author" href="https://tomayac.com/humans.txt"><style>#header,#navigation{background-color:#eee;margin:0 0 .5em}#content,#header{width:100%;max-width:100%;border:1px dashed silver}#aside,#content,#footer,#header,#navigation{border:1px dashed silver}#content a,#footer a{padding:.2em;text-decoration:none}#aside a,#content a,#content>h3 a,#footer a,#navigation a{text-decoration:none}#aside a:hover,#aside a:link,#aside a:visited,#content h2,#content h3,#content>h3 a,#footer a,body{color:#000}html{box-sizing:border-box}*,::after,::before{box-sizing:inherit}body{background-color:#fff;font-size:100%;font-family:HelveticaNeue-Light,"Helvetica Neue Light","Helvetica Neue",Helvetica,Arial,"Lucida Grande",sans-serif}#blog,#ccasion{font-size:1.5em;position:absolute;font-weight:700}#blog{top:0;left:1em;z-index:1;color:gold}#ccasion{top:.05em;left:2.12em;z-index:2;color:#ff8032}#header{font-size:1.2em;max-width:1400px;padding:0;overflow:hidden}#aside h2,#navigation h2{font-size:.9em}#container{display:-webkit-flex;display:flex;margin:0 .5em;max-width:calc(1400px - .5em)}@media (min-width:480px){#container{-webkit-flex-direction:row;flex-direction:row}}@media (max-width:480px){#container{-webkit-flex-direction:column;flex-direction:column}}#navigation-aside{display:-webkit-flex;display:flex}@media (min-width:480px){#navigation-aside{-webkit-flex-direction:column;flex-direction:column}}#navigation{width:120px}#navigation h2{margin:0;background-color:gold}#navigation a{display:block;overflow-x:hidden;padding:0 0 .2em;font-weight:700;color:#000}.category0:hover{background-color:#c0c0ff}.category1:hover{background-color:#ff8032}.category2:hover{background-color:#80ff00}.category3:hover{background-color:#ff0080}.category4:hover{background-color:#ff0}.category5:hover{background-color:#80ff80}.category6:hover{background-color:#ff8080}.category7:hover{background-color:#c0ff80}.category8:hover{background-color:#ffc080}#aside h2,#content h2{background-color:gold;margin:0}#aside a:hover,#footer a:hover{background-color:#80ffff}#aside{width:120px;margin:0 .5em .5em 0;background-color:#eee;overflow-x:hidden}#aside svg{vertical-align:middle}#aside p{margin:.5em}#aside a{display:block;padding:0;font-size:1em;font-weight:400}#content a,#content h2,#content h3,#footer a{font-weight:700}#content{margin:0}#content h2{font-size:1.2em}#content h3{font-size:1.1em;margin:0;background-color:#ff8032}#content p{font-size:1em;margin:.5em 0}#content img{margin:.5em 1em;max-width:100%}#content hr{height:1px;text-align:left;margin-left:0;border:1px solid silver}#content small{font-size:.9em;padding:.5em 0}#content a{display:inline}#content a:link{color:#00f}#content a:visited{color:#00008b}#content a:hover{color:#00f;text-decoration:underline}#footer{max-width:1400px;margin:.5em 0 0;padding:.5em}#footer ul{list-style:none}#footer li::before{content:"¬ª "}.blogPost{padding:.5em}.commentForm,.commentList{display:none}ul{padding-left:.5em;list-style-position:inside}pre{max-width:calc(100% - 1rem)}code{overflow-wrap:break-word;word-wrap:break-word;word-break:break-word}iframe{max-width:533px}@media (max-width:480px){#navigation-aside{-webkit-flex-direction:row;flex-direction:row}#navigation{width:50%}#aside>img,#navigation img{-webkit-transform-origin:left;-webkit-transform:scaleX(2);transform-origin:left;transform:scaleX(2)}#aside{width:50%;margin:0 0 .5em .5em}iframe,img{max-width:100%;layout:responsive}}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:0 0;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#282a36}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#6272a4}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#ff79c6}.token.boolean,.token.number{color:#bd93f9}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#50fa7b}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#f1fa8c}.token.keyword{color:#8be9fd}.token.important,.token.regex{color:#ffb86c}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style></head><body><header id="header"><a href="/"><img src="/static/city.jpg" alt="" width="1400" height="20"></a><a href="/"><div id="blog">blog</div><div id="ccasion">occasion</div></a>&nbsp;<strong>l'occasion</strong> <em>f</em> - Gelegenheit <em>f</em>, die ~ , der ~; <em>bei Gelegenheit</em> - <strong>&agrave; l'occasion</strong></header><div id="container"><div id="navigation-aside"><nav id="navigation"><h2>Tags</h2><a href="/"><img src="/static/mountains_sunrise.jpg" alt="" width="120" height="23"></a><a href="/blogccasion/tags/Private/" class="tag">Private</a> <a href="/blogccasion/tags/Technical/" class="tag">Technical</a> <a href="/blogccasion/tags/France/" class="tag">France</a> <a href="/blogccasion/tags/Work/" class="tag">Work</a> <a href="/blogccasion/tags/Political/" class="tag">Political</a><h2>Pages</h2><a href="/"><img src="/static/mountains_sunrise.jpg" alt="" width="120" height="23"></a><a class="nav-item" href="/blogccasion/">Home</a> <a class="nav-item" href="/blogccasion/posts/">Archive</a> <a class="nav-item" href="/blogccasion/about/">About</a></nav><aside id="aside"><h2>Related</h2><img src="/static/palms.jpg" alt="" width="120" height="23"><div><p><a href="/blogccasion/feed/feed.xml" rel="me"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="16" height="16" viewBox="0 0 256 256"><rect width="246" height="246" rx="50" ry="50" x="5" y="5" fill="#F49C52"/><rect width="236" height="236" rx="47" ry="47" x="10" y="10" fill="#F49C52"/><circle cx="68" cy="189" r="24" fill="#FFF"/><path d="M160 213h-34a82 82 0 0 0-82-82v-34a116 116 0 0 1 116 116zM184 213A140 140 0 0 0 44 73V38a175 175 0 0 1 175 175z" fill="#FFF"/></svg> Blog Feed</a></p><p><a href="https://twitter.com/tomayac" rel="me"><svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" height="16" width="16" version="1.1" viewBox="0 0 182.7 150.7"><defs><clipPath clipPathUnits="userSpaceOnUse"><path d="m0 10h1366.9v1110.9h-1366.9z"/></clipPath></defs><g transform="matrix(1.3333 0 0 -1.3333 0 150.67)"><g transform="scale(.1)"><g clip-path="url(#clipPath20)"><path d="m1366.9 989.4c-50.3-22.3-104.3-37.4-161-44.2 57.9 34.7 102.3 89.7 123.3 155.2-54.2-32.1-114.2-55.5-178.1-68-51.1 54.5-124 88.6-204.7 88.6-154.9 0-280.4-125.5-280.4-280.4 0-22 2.5-43.4 7.3-63.9-233.1 11.7-439.7 123.4-578 293-24.1-41.4-38-89.6-38-141 0-97.3 49.5-183.1 124.8-233.4-46 1.4-89.2 14.1-127 35.1 0-1.2 0-2.3 0-3.5 0-135.9 96.7-249.2 225-275-23.5-6.4-48.3-9.8-73.9-9.8-18.1 0-35.6 1.7-52.8 5 35.7-111.4 139.3-192.5 262-194.8-96.1-75.2-217-120-348.4-120-22.6 0-45 1.3-66.9 3.9 124.2-79.6 271.6-126 429.9-126 515.8 0 797.9 427.3 797.9 797.9 0 12.2-0.3 24.2-0.8 36.3 54.8 39.6 102.3 89 139.9 145.2" fill="#55ACEE"/></g></g></g></svg> @tomayac</a></p><p><a href="https://tomayac.com/tweets" rel="me"><svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" height="16" width="16" version="1.1" viewBox="0 0 182.7 150.7"><defs><clipPath clipPathUnits="userSpaceOnUse"><path d="m0 10h1366.9v1110.9h-1366.9z"/></clipPath></defs><g transform="matrix(1.3333 0 0 -1.3333 0 150.67)"><g transform="scale(.1)"><g clip-path="url(#clipPath20)"><path d="m1366.9 989.4c-50.3-22.3-104.3-37.4-161-44.2 57.9 34.7 102.3 89.7 123.3 155.2-54.2-32.1-114.2-55.5-178.1-68-51.1 54.5-124 88.6-204.7 88.6-154.9 0-280.4-125.5-280.4-280.4 0-22 2.5-43.4 7.3-63.9-233.1 11.7-439.7 123.4-578 293-24.1-41.4-38-89.6-38-141 0-97.3 49.5-183.1 124.8-233.4-46 1.4-89.2 14.1-127 35.1 0-1.2 0-2.3 0-3.5 0-135.9 96.7-249.2 225-275-23.5-6.4-48.3-9.8-73.9-9.8-18.1 0-35.6 1.7-52.8 5 35.7-111.4 139.3-192.5 262-194.8-96.1-75.2-217-120-348.4-120-22.6 0-45 1.3-66.9 3.9 124.2-79.6 271.6-126 429.9-126 515.8 0 797.9 427.3 797.9 797.9 0 12.2-0.3 24.2-0.8 36.3 54.8 39.6 102.3 89 139.9 145.2" fill="#55ACEE"/></g></g></g></svg> Tweet Archive</a></p><p><a href="/pgp_public_key.asc">üîê PGP Public Key</a></p></div></aside></div><main class="tmpl-post" id="content"><h2>A Look Inside the Think Tank...</h2><article class="blogPost"><header><a href="/blogccasion/2019/03/22/two-http-headers-related-to-service-workers-you-never-may-have-heard-of/"><h3>Two HTTP headers related to Service Workers you never may have heard¬†of</h3></a><div><small>Created on <b><time datetime="2019-03-22T09:51:16.943Z">Fri Mar 22 2019</time></b>. <a href="/tags/Technical" class="tag">Technical</a></small></div><div><small>Written by <b>Thomas Steiner</b>.</small></div><hr></header><h2 id="the-second-one-will-make-you-talk-to-your-webmaster%E2%80%A6">The second one will make you talk to your webmaster‚Ä¶ <a class="direct-link" href="#the-second-one-will-make-you-talk-to-your-webmaster%E2%80%A6" aria-hidden="true">#</a></h2><p>The other day, one of my former Google Mobile Solutions Consultant colleagues sent an email to an internal mailing list that (paraphrased) went like this:</p><blockquote><p>‚ÄúI was shocked that during now more than two years of supporting Service Worker implementations, I only found out about the <code>service-worker-allowed</code> header today.‚Äù üò≥</p></blockquote><p>I suspect at least some of you are the same, so let me explain not just this, but also a second interesting HTTP header related to Service Workers that are both probably <em>not</em> the ones you read about when you follow any of the many Service Worker tutorials out there.</p><h4 id="header-%E2%84%96-1%3A-%60service-worker-allowed%60"><strong>Header</strong> ‚Ññ 1: `<strong>service-worker-allowed`</strong> <a class="direct-link" href="#header-%E2%84%96-1%3A-%60service-worker-allowed%60" aria-hidden="true">#</a></h4><p>This is one of the a little more obscure Service Worker features, but it‚Äôs very useful. You can see it in action on Google Docs, where the URL you‚Äôre on with <a href="https://support.google.com/accounts/answer/1721977?co=GENIE.Platform%3DDesktop&amp;hl=en">multi-account login</a> is something like <code>https://docs.google.com/document/u/0/</code> (the final number determines the active account), but where the actual Service Worker JavaScript file comes from <code>https://docs.google.com/document/offline/serviceworker.js?ouid=ude32cf1e51077bff&amp;zx=hyah3kexco7d</code> (your query parameters may differ).</p><p>Now why does this matter? Let‚Äôs briefly recall the <a href="https://developers.google.com/web/ilt/pwa/introduction-to-service-worker#registration_and_scope">concept of a Service Worker‚Äôs</a> <code>[scope](https://developers.google.com/web/ilt/pwa/introduction-to-service-worker#registration_and_scope)</code>: The <code>scope</code> of the Service Worker determines which files the Service Worker controls, in other words, from which path the Service Worker will intercept requests. The default <code>scope</code> is the location of the Service Worker file, and extends to all directories below. So if <code>serviceworker.js</code> is located in the root directory, the Service Worker will control requests from all files at this domain.</p><p>Now you may notice that in the case of Google Docs, the default <code>scope</code> would be <code>https://docs.google.com/document/offline/</code>, which is not enough, as the user is working in <code>https://docs.google.com/document/u/0/</code>. This is where finally the <code>service-worker-allowed</code> header comes in. It allows Google Docs to ask for a wider <code>scope</code> of <code>https://docs.google.com/document/</code> instead üéâ. This header is <a href="https://wpt.fyi/results/service-workers/service-worker/Service-Worker-Allowed-header.https.html?label=master&amp;product=chrome%5Bexperimental%5D&amp;product=edge&amp;product=firefox%5Bexperimental%5D&amp;product=safari%5Bexperimental%5D&amp;aligned&amp;q=service-worker-allowed">supported by all browsers</a> and if you‚Äôre interested in all the details, this is the <a href="https://w3c.github.io/ServiceWorker/#service-worker-allowed">deep link to the header‚Äôs section in the spec</a>. You can see it in action in the screenshot below.</p><p><img src="/images/asset-1_copy.png" alt="HTTP header `service-worker-allowed` in action on Google¬†Docs"></p><h4 id="header-%E2%84%96-2%3A-%60service-worker%60">Header ‚Ññ 2: `<strong>service-worker`</strong> <a class="direct-link" href="#header-%E2%84%96-2%3A-%60service-worker%60" aria-hidden="true">#</a></h4><p>As we‚Äôre at it, another header you might not have heard of is <code>service-worker</code>. It indicates when a request is for a Service Worker‚Äôs script resource and helps administrators and webmasters log such requests and detect threats (so talk to them, they‚Äôll probably appreciate it; <a href="https://twitter.com/jaffathecake">Jake Archibald</a>‚Äôs <a href="https://jakearchibald.com/2014/launching-sw-without-breaking-the-web/#pros">article</a> has all the details). This header as well is <a href="https://wpt.fyi/results/service-workers/service-worker/service-worker-header.https.html?label=master&amp;product=chrome%5Bexperimental%5D&amp;product=edge&amp;product=firefox%5Bexperimental%5D&amp;product=safari%5Bexperimental%5D&amp;aligned&amp;q=service-worker">supported by all browsers</a>, and here is the <a href="https://w3c.github.io/ServiceWorker/#service-worker-script-request">deep link to its section in the spec</a>. You can see it in action when you go to Facebook. Facebook‚Äôs Service Worker comes from <code>[https://www.facebook.com/sw?s=push](https://www.facebook.com/sw?s=push)</code>, but if you try to open this URL, you‚Äôll not see the JavaScript code, but a Facebook error page. You actually <em>need</em> to send the header in order for Facebook to return the code.</p><p><img src="/images/asset-2_copy.png" alt="HTTP header `service-worker` in action on¬†Facebook"></p><p>This initially caught me when I developed the <a href="https://github.com/google/service-worker-detector#--installation">üë∑‚Äç‚ôÄÔ∏è üë∑ Service Worker Detector browser extension</a>, but after reading the spec, I was then <a href="https://github.com/google/service-worker-detector/blob/f257aa9a77951f8ec972bf271093c75e86f73e55/contentscript.js#L71-L75">sending the correct header</a> in the extension‚Äôs content script, so that it now works as expected.</p><p><img src="/images/asset-3__copy.png" alt="üë∑‚Äç‚ôÄÔ∏è üë∑ Service Worker Detector browser extension running on¬†Facebook"></p><p>If you encounter this header being required by the server, for quick debugging sessions in the browser or from the terminal, a cool Chrome DevTools tip is to right-click the Service Worker request and then ‚ÄúCopy as cURL‚Äù or ‚ÄúCopy as fetch‚Äù. üëå</p><p><img src="/images/asset-4.png" alt="Fetch a resource exactly as the browser did with ‚ÄúCopy as cURL‚Äù or ‚ÄúCopy as¬†fetch‚Äù"></p><p>Did <em>you</em> know about these headers? Let me know in the comments or ping me, <a href="https://twitter.com/tomayac">@tomayac</a>, on Twitter. Oh, by the way, while I still have your attention, the Mobile Solutions Consultant team (my former team) are <a href="https://careers.google.com/jobs/results/?company=Google&amp;company=YouTube&amp;employment_type=FULL_TIME&amp;hl=en_US&amp;jlo=en_US&amp;q=%22Mobile%20Solutions%20Consultant%22&amp;sort_by=relevance">hiring</a>, and so is my current team, the Chrome Developer Relations team, where we‚Äôre looking for <a href="https://careers.google.com/jobs/results/?company=Google&amp;company=YouTube&amp;employment_type=FULL_TIME&amp;hl=en_US&amp;jlo=en_US&amp;q=%22developer%20advocate,%20web%22&amp;sort_by=relevance">Developer Advocates</a> and <a href="https://careers.google.com/jobs/results/?company=Google&amp;company=YouTube&amp;employment_type=FULL_TIME&amp;hl=en_US&amp;jlo=en_US&amp;q=%22Developer%20Programs%20Engineer,%20Web%22&amp;sort_by=relevance">Developer Programs Engineers</a>‚Ä¶</p></article></main></div><footer id="footer"><ul><li>¬© 2005‚Äì2019 <a href="/about">Thomas Steiner</a></li><li>Distributed under <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></li><li>Contact and required <a href="/about/">legal info</a></li><li><small>This website uses Google Analytics</small></li></ul></footer></body></html>