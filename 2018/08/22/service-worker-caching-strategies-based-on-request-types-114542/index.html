<!doctype html><html><head><meta charset="utf-8"><title>Service Worker Caching Strategies Based on Request Types</title><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta property="twitter:account_id" content="1510101733"><meta name="Description" content="The personal blog of Thomas Steiner"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="/blogccasion/2018/08/22/service-worker-caching-strategies-based-on-request-types-114542/"><link rel="alternate" href="/blogccasion/feed/feed.xml" type="application/atom+xml" title="Blogccasion"><link type="text/plain" rel="author" href="https://tomayac.com/humans.txt"><style>#header,#navigation{background-color:#eee;margin:0 0 .5em}#content,#header{width:100%;max-width:100%;border:1px dashed silver}#aside,#content,#footer,#header,#navigation{border:1px dashed silver}#content a,#footer a{padding:.2em;text-decoration:none}#aside a,#content a,#content>h3 a,#footer a,#navigation a{text-decoration:none}#aside a:hover,#aside a:link,#aside a:visited,#content h2,#content h3,#content>h3 a,#footer a,body{color:#000}html{box-sizing:border-box}*,::after,::before{box-sizing:inherit}body{background-color:#fff;font-size:100%;font-family:HelveticaNeue-Light,"Helvetica Neue Light","Helvetica Neue",Helvetica,Arial,"Lucida Grande",sans-serif}#blog,#ccasion{font-size:1.5em;position:absolute;font-weight:700}#blog{top:0;left:1em;z-index:1;color:gold}#ccasion{top:.05em;left:2.12em;z-index:2;color:#ff8032}#header{font-size:1.2em;max-width:1400px;padding:0;overflow:hidden}#aside h2,#navigation h2{font-size:.9em}#container{display:-webkit-flex;display:flex;margin:0 .5em;max-width:calc(1400px - .5em)}@media (min-width:480px){#container{-webkit-flex-direction:row;flex-direction:row}}@media (max-width:480px){#container{-webkit-flex-direction:column;flex-direction:column}}#navigation-aside{display:-webkit-flex;display:flex}@media (min-width:480px){#navigation-aside{-webkit-flex-direction:column;flex-direction:column}}#navigation{width:120px}#navigation h2{margin:0;background-color:gold}#navigation a{display:block;overflow-x:hidden;padding:0 0 .2em;font-weight:700;color:#000}.category0:hover{background-color:#c0c0ff}.category1:hover{background-color:#ff8032}.category2:hover{background-color:#80ff00}.category3:hover{background-color:#ff0080}.category4:hover{background-color:#ff0}.category5:hover{background-color:#80ff80}.category6:hover{background-color:#ff8080}.category7:hover{background-color:#c0ff80}.category8:hover{background-color:#ffc080}#aside h2,#content h2{background-color:gold;margin:0}#aside a:hover,#footer a:hover{background-color:#80ffff}#aside{width:120px;margin:0 .5em .5em 0;background-color:#eee;overflow-x:hidden}#aside svg{vertical-align:middle}#aside p{margin:.5em}#aside a{display:block;padding:0;font-size:1em;font-weight:400}#content a,#content h2,#content h3,#footer a{font-weight:700}#content{margin:0}#content h2{font-size:1.2em}#content h3{font-size:1.1em;margin:0;background-color:#ff8032}#content p{font-size:1em;margin:.5em 0}#content img{margin:.5em 1em;max-width:100%}#content hr{height:1px;text-align:left;margin-left:0;border:1px solid silver}#content small{font-size:.9em;padding:.5em 0}#content a{display:inline}#content a:link{color:#00f}#content a:visited{color:#00008b}#content a:hover{color:#00f;text-decoration:underline}#footer{max-width:1400px;margin:.5em 0 0;padding:.5em}#footer ul{list-style:none}#footer li::before{content:"¬ª "}.blogPost{padding:.5em}.commentForm,.commentList{display:none}ul{padding-left:.5em;list-style-position:inside}pre{max-width:calc(100% - 1rem)}code{overflow-wrap:break-word;word-wrap:break-word;word-break:break-word}iframe{max-width:533px}@media (max-width:480px){#navigation-aside{-webkit-flex-direction:row;flex-direction:row}#navigation{width:50%}#aside>img,#navigation img{-webkit-transform-origin:left;-webkit-transform:scaleX(2);transform-origin:left;transform:scaleX(2)}#aside{width:50%;margin:0 0 .5em .5em}iframe,img{max-width:100%;layout:responsive}}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:0 0;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#282a36}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#6272a4}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#ff79c6}.token.boolean,.token.number{color:#bd93f9}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#50fa7b}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#f1fa8c}.token.keyword{color:#8be9fd}.token.important,.token.regex{color:#ffb86c}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style></head><body><header id="header"><a href="/"><img src="/static/city.jpg" alt="" width="1400" height="20"></a><a href="/"><div id="blog">blog</div><div id="ccasion">occasion</div></a>&nbsp;<strong>l'occasion</strong> <em>f</em> - Gelegenheit <em>f</em>, die ~ , der ~; <em>bei Gelegenheit</em> - <strong>&agrave; l'occasion</strong></header><div id="container"><div id="navigation-aside"><nav id="navigation"><h2>Tags</h2><a href="/"><img src="/static/mountains_sunrise.jpg" alt="" width="120" height="23"></a><a href="/blogccasion/tags/Private/" class="tag">Private</a> <a href="/blogccasion/tags/Technical/" class="tag">Technical</a> <a href="/blogccasion/tags/France/" class="tag">France</a> <a href="/blogccasion/tags/Work/" class="tag">Work</a> <a href="/blogccasion/tags/Political/" class="tag">Political</a><h2>Pages</h2><a href="/"><img src="/static/mountains_sunrise.jpg" alt="" width="120" height="23"></a><a class="nav-item" href="/blogccasion/">Home</a> <a class="nav-item" href="/blogccasion/posts/">Archive</a> <a class="nav-item" href="/blogccasion/about/">About</a></nav><aside id="aside"><h2>Related</h2><img src="/static/palms.jpg" alt="" width="120" height="23"><div><p><a href="/blogccasion/feed/feed.xml" rel="me"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="16" height="16" viewBox="0 0 256 256"><rect width="246" height="246" rx="50" ry="50" x="5" y="5" fill="#F49C52"/><rect width="236" height="236" rx="47" ry="47" x="10" y="10" fill="#F49C52"/><circle cx="68" cy="189" r="24" fill="#FFF"/><path d="M160 213h-34a82 82 0 0 0-82-82v-34a116 116 0 0 1 116 116zM184 213A140 140 0 0 0 44 73V38a175 175 0 0 1 175 175z" fill="#FFF"/></svg> Blog Feed</a></p><p><a href="https://twitter.com/tomayac" rel="me"><svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" height="16" width="16" version="1.1" viewBox="0 0 182.7 150.7"><defs><clipPath clipPathUnits="userSpaceOnUse"><path d="m0 10h1366.9v1110.9h-1366.9z"/></clipPath></defs><g transform="matrix(1.3333 0 0 -1.3333 0 150.67)"><g transform="scale(.1)"><g clip-path="url(#clipPath20)"><path d="m1366.9 989.4c-50.3-22.3-104.3-37.4-161-44.2 57.9 34.7 102.3 89.7 123.3 155.2-54.2-32.1-114.2-55.5-178.1-68-51.1 54.5-124 88.6-204.7 88.6-154.9 0-280.4-125.5-280.4-280.4 0-22 2.5-43.4 7.3-63.9-233.1 11.7-439.7 123.4-578 293-24.1-41.4-38-89.6-38-141 0-97.3 49.5-183.1 124.8-233.4-46 1.4-89.2 14.1-127 35.1 0-1.2 0-2.3 0-3.5 0-135.9 96.7-249.2 225-275-23.5-6.4-48.3-9.8-73.9-9.8-18.1 0-35.6 1.7-52.8 5 35.7-111.4 139.3-192.5 262-194.8-96.1-75.2-217-120-348.4-120-22.6 0-45 1.3-66.9 3.9 124.2-79.6 271.6-126 429.9-126 515.8 0 797.9 427.3 797.9 797.9 0 12.2-0.3 24.2-0.8 36.3 54.8 39.6 102.3 89 139.9 145.2" fill="#55ACEE"/></g></g></g></svg> @tomayac</a></p><p><a href="https://tomayac.com/tweets" rel="me"><svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" height="16" width="16" version="1.1" viewBox="0 0 182.7 150.7"><defs><clipPath clipPathUnits="userSpaceOnUse"><path d="m0 10h1366.9v1110.9h-1366.9z"/></clipPath></defs><g transform="matrix(1.3333 0 0 -1.3333 0 150.67)"><g transform="scale(.1)"><g clip-path="url(#clipPath20)"><path d="m1366.9 989.4c-50.3-22.3-104.3-37.4-161-44.2 57.9 34.7 102.3 89.7 123.3 155.2-54.2-32.1-114.2-55.5-178.1-68-51.1 54.5-124 88.6-204.7 88.6-154.9 0-280.4-125.5-280.4-280.4 0-22 2.5-43.4 7.3-63.9-233.1 11.7-439.7 123.4-578 293-24.1-41.4-38-89.6-38-141 0-97.3 49.5-183.1 124.8-233.4-46 1.4-89.2 14.1-127 35.1 0-1.2 0-2.3 0-3.5 0-135.9 96.7-249.2 225-275-23.5-6.4-48.3-9.8-73.9-9.8-18.1 0-35.6 1.7-52.8 5 35.7-111.4 139.3-192.5 262-194.8-96.1-75.2-217-120-348.4-120-22.6 0-45 1.3-66.9 3.9 124.2-79.6 271.6-126 429.9-126 515.8 0 797.9 427.3 797.9 797.9 0 12.2-0.3 24.2-0.8 36.3 54.8 39.6 102.3 89 139.9 145.2" fill="#55ACEE"/></g></g></g></svg> Tweet Archive</a></p><p><a href="/pgp_public_key.asc">üîê PGP Public Key</a></p></div></aside></div><main class="tmpl-post" id="content"><h2>A Look Inside the Think Tank...</h2><article class="blogPost"><header><a href="/blogccasion/2018/08/22/service-worker-caching-strategies-based-on-request-types-114542/"><h3>Service Worker Caching Strategies Based on Request Types</h3></a><div><small>Created on <b><time datetime="2018-08-22T11:45:42.000Z">Wed Aug 22 2018</time></b>. <a href="/tags/Technical" class="tag">Technical</a></small></div><div><small>Written by <b>Thomas Steiner</b>.</small></div><hr></header><p>(This article was cross-posted to <a href="https://medium.com/dev-channel/service-worker-caching-strategies-based-on-request-types-57411dd7652c">Medium.com</a>.)</p><h4 id="ce36">TL;DR</h4><p id="f502">Instead of purely relying on URL-based pattern matching, also consider leveraging the lesser-known--but super useful--<code><a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/destination" data-href="https://developer.mozilla.org/en-US/docs/Web/API/Request/destination" rel="nofollow noopener nofollow noopener" target="_blank">Request.destination</a></code> property in your service worker to determine the type and/or caching strategy of requests. Note, though, that <code>Request.destination</code> gets set to the non-informative empty string default value for <code>XMLHttpRequest</code> or <code>fetch()</code> calls. You can play with the <code><a href="https://request-destination-playground.glitch.me/" data-href="https://request-destination-playground.glitch.me/" rel="nofollow noopener noopener nofollow noopener" target="_blank">Request.destination</a></code><a href="https://request-destination-playground.glitch.me/" data-href="https://request-destination-playground.glitch.me/" rel="nofollow noopener noopener nofollow noopener" target="_blank">playground app</a> to see <code>Request.destination</code> in action.</p><h4 id="e541">Different Caching Strategies for Different Types of Resources</h4><p id="fd06">When it comes to establishing caching strategies for Progressive Web Apps, not all resources should be treated equally. For example, for a shopping PWA, your API calls that return live data on some items' availabilities might be configured to use a <a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#network-only" data-href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#network-only" rel="nofollow noopener nofollow noopener" target="_blank">Network Only</a> strategy, your self-hosted company-owned web fonts might be configured to use a <a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#cache-only" data-href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#cache-only" rel="nofollow noopener nofollow noopener" target="_blank">Cache Only</a> strategy, and your other HTML, CSS, JavaScript, and image resources might use a <a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#network-falling-back-to-cache" data-href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#network-falling-back-to-cache" rel="nofollow noopener nofollow noopener" target="_blank">Network Falling Back to Cache</a> strategy.</p><h4 id="4b80">URL-based Determination of the Request&nbsp;Type</h4><p id="dc45">Commonly, developers have relied on the known URL structure of their PWAs and regular expressions to determine the appropriate caching strategy for a given request. For example, here's an excerpt of a modified code snippet courtesy of <a href="https://twitter.com/jaffathecake" data-href="https://twitter.com/jaffathecake" rel="nofollow noopener" target="_blank">Jake Archibald</a>'s <a href="https://jakearchibald.com/2014/offline-cookbook/" data-href="https://jakearchibald.com/2014/offline-cookbook/" rel="nofollow noopener" target="_blank">offline cookbook</a>:</p><pre id="ec5a">// In serviceworker.js<br>self.addEventListener('fetch', (event) =&gt; {<br>  // Parse the URL<br>  const requestURL = new URL(event.request.url);<br>  // Handle article URLs<br>  if (/^<strong>\/</strong>article<strong>\/</strong>/.test(requestURL.pathname)) {<br>    event.respondWith(/* some response strategy */);<br>    return;<br>  }<br>  if (/<strong>\.</strong>webp$/.test(requestURL.pathname)) {<br>    event.respondWith(/* some other response strategy */);<br>    return;<br>  }<br>  /* ¬Ö */<br>});</pre><p id="1add">This approach allows developers to deal with their <a href="https://developers.google.com/speed/webp/" data-href="https://developers.google.com/speed/webp/" rel="nofollow noopener" target="_blank">WebP images</a> (<em>i.e.</em>, requests that match the regular expression <code>/\.webp$/</code>) differently than with their HTML articles (<em>i.e.</em>, requests that match <code>/^\/article\//</code>). The downside of this approach is that it makes hard-coded assumptions about the URL structure of a PWA or the used MIME types' file extensions, which creates a tight coupling between app and service worker logic. Should you move away from WebP to a future superior image format, you would need to remember to update your service worker's logic as well.</p><h4 id="3b5d"><code>Request.destination</code>-based Determination of the Request&nbsp;Type</h4><p id="f402">It turns out, the platform has a built-in way for determining the type of a request: it's called <code><a href="https://fetch.spec.whatwg.org/#concept-request-destination" data-href="https://fetch.spec.whatwg.org/#concept-request-destination" rel="nofollow noopener" target="_blank">Request.destination</a></code> as specified in the <a href="https://fetch.spec.whatwg.org/" data-href="https://fetch.spec.whatwg.org/" rel="nofollow noopener" target="_blank">Fetch Standard</a>. Quoting straight from the spec:</p><blockquote id="4d25"><em>¬ìA request has an associated destination, which is the empty string, </em><code><em>"audio"</em></code><em>, </em><code><em>"audioworklet"</em></code><em>, </em><code><em>"document"</em></code><em>, </em><code><em>"embed"</em></code><em>, </em><code><em>"font"</em></code><em>, </em><code><em>"image"</em></code><em>, </em><code><em>"manifest"</em></code><em>, </em><code><em>"object"</em></code><em>, </em><code><em>"paintworklet"</em></code><em>, </em><code><em>"report"</em></code><em>, </em><code><em>"script"</em></code><em>, </em><code><em>"serviceworker"</em></code><em>, </em><code><em>"sharedworker"</em></code><em>, </em><code><em>"style"</em></code><em>, </em><code><em>"track"</em></code><em>, </em><code><em>"video"</em></code><em>, </em><code><em>"worker"</em></code><em>, or </em><code><em>"xslt"</em></code><em>. Unless stated otherwise it is the empty string.¬î</em></blockquote><p id="ef87">The empty string default value is the biggest caveat. Essentially, you can't determine the type of resources that are requested via the following methods:</p><blockquote id="7d4a"><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/sendBeacon" data-href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/sendBeacon" rel="nofollow noopener" target="_blank"><em>navigator.sendBeacon()</em></a></code><em>, </em><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource" data-href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource" rel="nofollow noopener" target="_blank"><em>EventSource</em></a></code><em>, HTML's </em><code><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attr-ping" data-href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attr-ping" rel="nofollow noopener" target="_blank"><em>&lt;a ping=""&gt;</em></a></code><em> and </em><code><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/area#attr-ping" data-href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/area#attr-ping" rel="nofollow noopener" target="_blank"><em>&lt;area ping=""&gt;</em></a></code><em>, </em><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" data-href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="nofollow noopener" target="_blank"><em>fetch()</em></a></code><em>, </em><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest" data-href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest" rel="nofollow noopener" target="_blank"><em>XMLHttpRequest</em></a></code><em>, </em><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" data-href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" rel="nofollow noopener" target="_blank"><em>WebSocket</em></a></code><em>, [and the] </em><a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache" data-href="https://developer.mozilla.org/en-US/docs/Web/API/Cache" rel="nofollow noopener" target="_blank"><em>Cache API</em></a></blockquote><p id="8c44">In practice having <code>Request.destination</code> get set to the non-informative empty string default value matters the most for <code>fetch()</code> and <code>XMLHttpRequest</code>, so at least for resources requested through these techniques, it's oftentimes back to URL-based pattern handling inside your service worker.</p><p id="cf8f">On the bright side, you can determine the type of everything else perfectly fine. I have built a little <code><a href="https://request-destination-playground.glitch.me/" data-href="https://request-destination-playground.glitch.me/" rel="nofollow noopener" target="_blank">Request.destination</a></code><a href="https://request-destination-playground.glitch.me/" data-href="https://request-destination-playground.glitch.me/" rel="nofollow noopener" target="_blank">playground app</a> that shows some of these destinations in action. Note that for the sake of the to-be-demonstrated effect it also contains some anti-patterns like <a href="https://developers.google.com/web/fundamentals/primers/service-workers/registration" data-href="https://developers.google.com/web/fundamentals/primers/service-workers/registration" rel="nofollow noopener" target="_blank">registering the service worker</a> as early as possible and actively circumventing the browser's preloading heuristics (never do this in production).</p><figure><img width="788" height="1600" src="/images/req_dest_img2.png"><figcaption><em>An </em><code><em>&lt;img&gt;</em></code> <em>, two </em><code><em>&lt;p&gt;</em></code> <em>s with background images and triggers for </em><code><em>XMLHttpRequest</em></code> <em>or </em><code><em>fetch()</em></code> <em>, an </em><code><em>&lt;iframe&gt;</em></code> <em>, and a </em><code><em>&lt;video&gt;</em></code> <em>with poster image and timed text&nbsp;track</em></figcaption></figure><p id="b98d">When you think about it, there are a huge number of ways a page can request resources to load. A <code>&lt;video&gt;</code> can load an image as its poster frame and a timed text track file via <code>&lt;track&gt;</code>, apart from the video bytes it obviously loads. A stylesheet can cause images to load that are used somewhere on the page as background images, as well as web fonts. An <code>&lt;iframe&gt;</code> loads an HTML document. Oh, and the HTML document itself can load manifests, stylesheets, scripts, images, and a ton of other elements like <code>&lt;object&gt;</code> that was quite popular in the past to load Flash movies.</p><figure><img width="788" height="1600" src="/images/req_dest_img2.png"><figcaption><code><em>Request.destination</em></code> <em>playground app showing different request&nbsp;types</em></figcaption></figure><p id="9bd9">Coming back to the initial example of the shopping PWA, we could come up with a simple service worker router as outlined in the code below. This router is completely agnostic of the URL structure, so there's no tight coupling at all.</p><pre id="3c43">// In serviceworker.js<br>self.addEventListener('fetch', (event) =&gt; {<br>  const destination = event.request.destination;<br>  switch (destination) {<br>    case 'style':<br>    case 'script':<br>    case 'document':<br>    case 'image': {<br>      event.respondWith(<br>          /* "Network Falling Back to Cache" strategy */);<br>      return;<br>    }<br>    case 'font': {<br>      event.respondWith(/* "Cache Only" strategy */);<br>      return;<br>    }<br>    // All `XMLHttpRequest` or `fetch()` calls where<br>    // `Request.destination` is the empty string default value<br>    default: {<br>      event.respondWith(/* "Network Only" strategy */);<br>      return;<br>    }<br>  }<br>});</pre><h4 id="0828">Browser Support for <code>Request.destination</code></h4><p id="bbe6"><code>Request.destination</code> is universally supported by Chrome, Opera, Firefox, Safari, and Edge. For Chrome, support was added in Chrome 65, so for the unlikely case where your target audience uses older browsers than that, you might want to be careful with fully relying on this feature for your router. Other than that, <code>Request.destination</code> is ready for business. You can see the full details on the corresponding <a href="https://www.chromestatus.com/feature/5629697845100544" data-href="https://www.chromestatus.com/feature/5629697845100544" rel="nofollow noopener" target="_blank">Chrome Platform Status page</a>.</p><h4 id="64cf">When <code>Request.destination</code> isn't&nbsp;Enough</h4><p id="14ec">If you have more complex caching needs, you will soon realize that <em>purely</em> relying on <code>Request.destination</code> is <em>not</em> enough. For example, all your stylesheets may indeed use the same response strategy (and thus be good candidates for <code>Request.destination</code>), however, your HTML documents or API requests might still require different caching logic the more advanced your app gets.</p><p id="6b03">Fortunately, you can freely combine <code>Request.destination</code> with URL-based pattern matching, there's absolutely no harm in doing so. A basic example could be to use <code>Request.destination</code> for dealing with all kinds of images to return a default offline fallback placeholder, and to use <code>Request.url</code> with URL-based pattern matching for other resources. You can likewise decide to have different behavior based on the <code>Request.mode</code> of the request, for instance to check if you are dealing with a navigational request (<code>Request.mode === 'navigate'</code>) in single-page apps.</p><h4 id="e395">Conclusion</h4><p id="be21">Coming up with a reasonable caching strategy for a PWA is hard enough. Having ways to tame this complexity is definitely welcome, so whenever feasible?¬ó?given your PWA's structure?¬ó?in addition to URL-based pattern handling, also consider leveraging <code>Request.destination</code> for your service worker's routing logic. It may not be able to handle all routes and there are important exceptions and corner cases, but it's definitely a good idea to reduce the coupling of service worker logic and URL structure as much as possible.</p><h4 id="42bd">Acknowledgements</h4><p id="989b">Thanks to <a href="https://twitter.com/mathias" data-href="https://twitter.com/mathias" rel="nofollow noopener" target="_blank">Mathias Bynens</a>, <a href="https://twitter.com/jeffposnick" data-href="https://twitter.com/jeffposnick" rel="nofollow noopener" target="_blank">Jeff Posnick</a>, <a href="https://twitter.com/addyosmani" data-href="https://twitter.com/addyosmani" rel="nofollow noopener" target="_blank">Addy Osmani</a>, <a href="https://twitter.com/rowan_m" data-href="https://twitter.com/rowan_m" rel="nofollow noopener" target="_blank">Rowan Merewood</a>, and <a href="https://twitter.com/ialbmedina">Alberto Medina</a> for reviewing this article, and again Mathias for his help with debugging emoji encoding in Edge!</p></article></main></div><footer id="footer"><ul><li>¬© 2005‚Äì2019 <a href="/about">Thomas Steiner</a></li><li>Distributed under <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></li><li>Contact and required <a href="/about/">legal info</a></li><li><small>This website uses Google Analytics</small></li></ul></footer></body></html>