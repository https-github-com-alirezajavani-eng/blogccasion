<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta property="twitter:account_id" content="1510101733"><meta name="description" content="The personal blog of Thomas Steiner"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><link rel="icon" href="/images/thomas_steiner.jpg"><link rel="canonical" href="/blogccasion/2018/11/08/why-browsers-download-stylesheets-with-non-matching-media-queries-180513/"><link rel="alternate" href="/blogccasion/feed/feed.xml" type="application/atom+xml" title="Blogccasion"><link rel="author" href="https://tomayac.com/humans.txt" type="text/plain"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet"><script>if (window.matchMedia('(prefers-color-scheme: dark)').media === 'not all') {
        document.documentElement.style.display = 'none';
        document.head.insertAdjacentHTML(
            'beforeend',
            '<link rel="stylesheet" href="/light.css" onload="document.documentElement.style.display = \'\'">'
        );
      }</script><link rel="stylesheet" href="/css/light.css" media="(prefers-color-scheme:light),(prefers-color-scheme:no-preference)"><link rel="stylesheet" href="/css/dark.css" media="(prefers-color-scheme:dark)"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/prism-theme.css"><title>Why Browsers Download Stylesheets With Non-Matching Media Queries</title><script type="module" src="/js/script.mjs"></script></head><body><div class="container"><header><a href="/"><h1>blogccasion</h1></a><div class="header-footer-text"><span lang="fr"><strong>l'occasion</strong> <em>f</em> — </span><span lang="de">Gelegenheit</span> <em>f</em>, die ~ , der ~; <em>bei Gelegenheit</em> — <span lang="fr"><strong>à l'occasion</strong></span></div></header><nav><h2>Pages</h2><ul><li><a class="nav-item" href="/blogccasion/">Home</a></li><li><a class="nav-item" href="/blogccasion/posts/">Archive</a></li><li><a class="nav-item" href="/blogccasion/about/">About</a></li></ul><h2>Tags</h2><ul><li><a href="/blogccasion/tags/Private/" class="tag">Private</a></li><li><a href="/blogccasion/tags/Technical/" class="tag">Technical</a></li><li><a href="/blogccasion/tags/France/" class="tag">France</a></li><li><a href="/blogccasion/tags/Work/" class="tag">Work</a></li><li><a href="/blogccasion/tags/Political/" class="tag">Political</a></li></ul></nav><svg xmlns="http://www.w3.org/2000/svg"><symbol id="icon-rss" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></symbol><symbol id="icon-twitter" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></symbol><symbol id="icon-pgp" aria-label="Lock" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#29303d"/><g fill="#29303d"><path stroke="#e0e4eb" stroke-width="32" d="M346 214v-37c0-123-180-123-180 0v37"/><rect fill="#ff0" height="210" rx="5%" width="280" x="115" y="210"/><circle cx="256" cy="296" r="28"/><path d="M262 296h-12l-16 69h44"/></g></symbol><symbol id="icon-github" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></symbol></svg><aside><h2>Related</h2><ul><li><a class="aside-item" href="/blogccasion/feed/feed.xml" rel="me"><svg class="icon"><use xlink:href="#icon-rss"></use></svg> Blog Feed</a></li><li><a class="aside-item" href="https://twitter.com/tomayac" rel="me"><svg class="icon"><use xlink:href="#icon-twitter"></use></svg> Twitter</a></li><li><a class="aside-item" href="https://tomayac.com/tweets" rel="me"><svg class="icon"><use xlink:href="#icon-twitter"></use></svg> Tweet Archive</a></li><li><a class="aside-item" href="https://github.com/tomayac" rel="me"><svg class="icon"><use xlink:href="#icon-github"></use></svg> GitHub</a></li><li><a class="aside-item" href="/pgp_public_key.asc"><svg class="icon"><use xlink:href="#icon-pgp"></use></svg> Public Key</a></li></ul></aside><main class="tmpl-post"><article><header><a href="/blogccasion/2018/11/08/why-browsers-download-stylesheets-with-non-matching-media-queries-180513/"><h3>Why Browsers Download Stylesheets With Non-Matching Media Queries</h3></a><div class="metadata post-date"><img class="author" src="/images/thomas_steiner.jpg" alt="Thomas Steiner headshot"><p>By <a href="/about/">Thomas Steiner</a>. Written on <time datetime="2018-11-08T18:05:13.000Z">Thu Nov 08 2018</time>. <a href="/tags/Technical" class="tag"><b>Technical</b></a></p></div></header><p>The other day, I read an article by <a href="https://github.com/dgieselaar">Dario Gieselaar</a> on <a href="https://medium.com/zoover-engineering/optimizing-css-by-removing-unused-media-queries-80b5508c6de9">Optimizing CSS by removing unused media queries</a>. One of the core ideas is that you can use the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/link#attr-media"><code>media</code> attribute</a> when including your stylesheets like so:</p><pre><code>&lt;link href="print.css" rel="stylesheet" media="print"&gt;
&lt;link href="mobile.css" rel="stylesheet" media="screen and (max-width: 600px)"&gt;</code></pre><p>In the article, Dario links to <a href="https://github.com/scottjehl">Scott Jehl</a>'s <a href="http://scottjehl.github.io/CSS-Download-Tests/">CSS Downloads by Media Query</a> test suite where Scott shows how <em>browsers would still download stylesheets even if their media queries are non-matching</em>.</p><p>I <a href="https://github.com/scottjehl/CSS-Download-Tests/issues/11#issue-378471829">pointed out</a> that the priority of these downloads is <code>Lowest</code>, so they're at least not competing with core resources on the page:</p><p><img src="https://user-images.githubusercontent.com/145676/48161126-2073ad80-e2da-11e8-9699-92f7e95cb5b8.png" width="412" height="252" alt="Waterfall diagram showing how stylesheets with non-matching media queries are downloaded at lowest priority"></p><p>At first sight this still seemed suboptimal, and I thought that even if the priority is <code>Lowest</code>, maybe the browser shouldn't trigger downloads at all. So I did some research, and, surprise, it turns out that the CSS spec writers and browser implementors are actually pretty darn smart about this:</p><p>The thing is, the user <em>could</em> always decide to resize their window (impacting <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/width">width</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/height">height</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/aspect-ratio">aspect ratio</a>), to <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries#Media_types">print</a> the document, <em>etc.</em>, and even things that at first sight <em>seem</em> static (like the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/resolution">resolution</a>) can change when a user with a multi-screen setup moves a window from say a <em>Retina</em> laptop screen to a bigger desktop monitor, or the user can unplug their <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/any-pointer">mouse</a>, and so on.</p><p>Truly static things that can't change (a TV device can't suddenly turn into something else) are actually being <em>deprecated</em> in <a href="https://drafts.csswg.org/mediaqueries">Media Queries Level 4</a> (see the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries#Media_types">yellow note box</a>); and the recommendation is to rather target <a href="https://drafts.csswg.org/mediaqueries/#media-feature">media features</a> instead (see the text under the <a href="https://drafts.csswg.org/mediaqueries/#media-types">red issue box</a>).</p><p>Finally, even invalid values like <code>media="nonsense"</code> still need to be considered, according to the <a href="https://www.w3.org/TR/CSS2/conform.html#ignore">ignore rules</a> in the spec.</p><p>So long story short, browsers try to be as smart as possible by applying priorities, and <code>Lowest</code> is a reasonable value for the cases in Scott's <a href="http://scottjehl.github.io/CSS-Download-Tests/">test</a>.</p></article><p>You can <a href="https://github.com/tomayac/blogccasion/tree/master/./posts/2018-11-08_why-browsers-download-stylesheets-with-non-matching-media-queries.html" rel="nofollow">edit this page on GitHub</a>.</p></main><footer id="footer"><a class="validator" href="https://html5.validator.nu/?doc=https://blog.tomayac.com//blogccasion/2018/11/08/why-browsers-download-stylesheets-with-non-matching-media-queries-180513/"><img src="/static/validhtml5.svg" width="88" height="31" alt="Valid HTML5 badge"></a><dark-mode-toggle permanent dark="Light Theme" light="Dark Theme"></dark-mode-toggle><ul class="header-footer-text"><li>© 2005–2019 <a class="footer-link" href="/about">Thomas Steiner</a>.</li><li>Distributed under <a class="footer-link" rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.</li><li>Contact and required <a class="footer-link" href="/about/">legal info</a>.</li></ul></footer></div></body></html>